{"version":3,"file":"admin_addons2.js","sources":["../../resources/js/admin_addons2.js"],"sourcesContent":["import { nanoid } from 'nanoid';\nimport Cookies from 'js-cookie';\n\nObject.assign(window, { Cookies });\n\njQuery(function ($) {\n\n    // random id\n    function rand_element_init( el ) {\n        const $el = $( el );\n        const _rand = nanoid( 9 );\n        $el.addClass( _rand );\n\n        let _id = $el.attr( 'id' );\n        if ( !_id ) {\n            _id = _rand;\n            $el.attr( 'id', _id );\n        }\n\n        return _id;\n    }\n\n    // codemirror\n    if ( typeof codemirror_settings !== 'undefined' ) {\n        const codemirror_css = [ ...document.querySelectorAll( '.codemirror_css' ) ];\n        const codemirror_html = [ ...document.querySelectorAll( '.codemirror_html' ) ];\n\n        function initializeCodeMirror( elements, settings, type ) {\n            elements.forEach( function ( el ) {\n                if ( !el.CodeMirror ) {\n                    console.log( `Initializing CodeMirror for ${ type } on element:`, el );\n                    rand_element_init( el );\n                    let editorSettings = settings ? { ...settings } : {};\n                    editorSettings.codemirror = {\n                        ...editorSettings.codemirror,\n                        indentUnit: 3,\n                        tabSize: 3,\n                        autoRefresh: true,\n                    };\n                    el.CodeMirror = wp.codeEditor.initialize( el, editorSettings );\n                } else {\n                    console.log( `CodeMirror already initialized for ${ type } on element:`, el );\n                }\n            } );\n        }\n\n        initializeCodeMirror( codemirror_css, codemirror_settings.codemirror_css, 'CSS' );\n        initializeCodeMirror( codemirror_html, codemirror_settings.codemirror_html, 'HTML' );\n    }\n\n    $.fn.fadeOutAndRemove = function (speed) {\n        return this.fadeOut(speed, function () {\n            $(this).remove();\n        });\n    };\n\n    $.fn.serializeObject = function () {\n        let obj = {};\n        let array = this.serializeArray();\n\n        $.each(array, function () {\n            let name = this.name;\n            let value = this.value || '';\n\n            // Check if the name ends with []\n            if (name.indexOf('[]') > -1) {\n                name = name.replace('[]', '');\n\n                // Ensure the object property is an array\n                if (!obj[name]) {\n                    obj[name] = [];\n                }\n\n                // Push the value into the array\n                obj[name].push(value);\n            } else {\n                // Check if the object already has a property with the given name\n                if (obj[name] !== undefined) {\n                    if (!Array.isArray(obj[name])) {\n                        obj[name] = [obj[name]];\n                    }\n                    obj[name].push(value);\n                } else {\n                    obj[name] = value;\n                }\n            }\n        });\n\n        return obj;\n    };\n\n    // hide notice\n    $(document).on('click', '.notice-dismiss', function (e) {\n        $(this).closest('.notice.is-dismissible')?.fadeOutAndRemove(400);\n    });\n\n    // ajax submit settings\n    $(document).on('submit', '#_settings_form', function (e) {\n        e.preventDefault();\n        let $this = $(this);\n\n        let btn_submit = $this.find('button[name=\"_submit_settings\"]');\n        let button_text = btn_submit.html();\n        //let button_text_loading = '<i class=\"fa-solid fa-spinner fa-spin-pulse\"></i>';\n        let button_text_loading = '<span class=\"ajax-loader\">&nbsp;</span>';\n\n        btn_submit.prop('disabled', true).html(button_text_loading);\n        $.ajax({\n            type: 'POST',\n            url: ajaxurl,\n            data: {\n                action: 'submit_settings',\n                _data: $this.serializeObject(),\n                _ajax_nonce: $this.find('input[name=\"_wpnonce\"]').val(),\n                _wp_http_referer: $this.find('input[name=\"_wp_http_referer\"]').val(),\n            },\n        })\n        .done(function (data) {\n            btn_submit.prop('disabled', false).html(button_text);\n            $this.find('#_content').prepend(data);\n\n            // dismissible auto hide\n            setTimeout(() => {\n                $this.find('#_content').find('.dismissible-auto')?.fadeOutAndRemove(400);\n            }, 4000);\n        })\n        .fail(function (jqXHR, textStatus, errorThrown) {\n            btn_submit.prop('disabled', false).html(button_text);\n            console.log(errorThrown);\n        });\n    });\n\n    // filter tabs\n    const filter_tabs = $('.filter-tabs');\n    $.each(filter_tabs, function (i, el) {\n        const $el = $(el),\n            _id = rand_element_init(el),\n            $nav = $el.find('.tabs-nav'),\n            $content = $el.find('.tabs-content');\n\n        const _cookie = `cookie_${_id}_${i}`;\n        let cookieValue = Cookies.get(_cookie);\n\n        if (!cookieValue) {\n            cookieValue = $nav.find('a:first').attr('href');\n            Cookies.set(_cookie, cookieValue, { expires: 7, path: '', secure: true });\n        }\n        $nav.find('a.current').removeClass('current');\n        $nav.find(`a[href=\"${cookieValue}\"]`).addClass('current');\n        $nav.find('a')\n            .on('click', function (e) {\n                e.preventDefault();\n\n                const $this = $(this);\n                const hash = $this.attr('href');\n                Cookies.set(_cookie, hash, { expires: 7, path: '', secure: true });\n\n                $nav.find('a.current').removeClass('current');\n                $content.find('.tabs-panel:visible').removeClass('show')?.hide();\n\n                $($this.attr('href')).addClass('show')?.show();\n                $this.addClass('current');\n            })\n            .filter('.current')\n            .trigger('click');\n    });\n\n    // select2 multiple\n    const select2_multiple = $( '.select2-multiple' );\n    $.each( select2_multiple, function ( i, el ) {\n        $( el ).select2( {\n            multiple: true,\n            allowClear: true,\n            width: 'resolve',\n            dropdownAutoWidth: true,\n            placeholder: $( el ).attr( 'placeholder' ),\n        } );\n    } );\n\n    // select2 tags\n    const select2_tags = $( '.select2-tags' );\n    $.each( select2_tags, function ( i, el ) {\n        $( el ).select2( {\n            multiple: true,\n            tags: true,\n            allowClear: true,\n            width: 'resolve',\n            dropdownAutoWidth: true,\n            placeholder: $( el ).attr( 'placeholder' ),\n        } );\n    } );\n\n    // select2 IPs\n    const select2_ips = $( '.select2-ips' );\n    $.each( select2_ips, function ( i, el ) {\n        $( el ).select2( {\n            multiple: true,\n            tags: true,\n            allowClear: true,\n            width: 'resolve',\n            dropdownAutoWidth: true,\n            placeholder: $( el ).attr( 'placeholder' ),\n            createTag: function ( params ) {\n                let term = $.trim( params.term );\n\n                // Validate the term as an IP address or range\n                if ( isValidIPRange( term ) ) {\n                    return {\n                        id: term, text: term,\n                    };\n                } else {\n                    return null;\n                }\n            },\n        } );\n    } );\n});\n\n/**\n * validate IP range (IPv4)\n *\n * @param range\n * @returns {boolean}\n */\nfunction isValidIPRange( range ) {\n    const ipPattern = /^(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})\\.(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})\\.(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})\\.(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})$/;\n    const rangePattern = /^(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})\\.(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})\\.(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})\\.(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})-(\\d|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])$/;\n    const cidrPattern = /^(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})\\.(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})\\.(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})\\.(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})\\/(\\d|[1-2]\\d|3[0-2])$/;\n\n    if ( ipPattern.test( range ) ) {\n        return true;\n    }\n\n    if ( rangePattern.test( range ) ) {\n        const [ startIP, endRange ] = range.split( '-' );\n        const endIP = startIP.split( '.' ).slice( 0, 3 ).join( '.' ) + '.' + endRange;\n        return compareIPs( startIP, endIP ) < 0;\n    }\n\n    return cidrPattern.test( range );\n}\n\n/**\n * compare two IP addresses\n *\n * @param ip1\n * @param ip2\n * @returns {number}\n */\nfunction compareIPs( ip1, ip2 ) {\n    const ip1Parts = ip1.split( '.' ).map( Number );\n    const ip2Parts = ip2.split( '.' ).map( Number );\n\n    for ( let i = 0; i < 4; i++ ) {\n        if ( ip1Parts[i] < ip2Parts[i] ) return -1;\n        if ( ip1Parts[i] > ip2Parts[i] ) return 1;\n    }\n    return 0;\n}\n"],"names":["Cookies"],"mappings":"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"}