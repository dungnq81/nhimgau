{"version":3,"file":"admin_addons2.js","sources":["../../resources/js/admin_addons2.js"],"sourcesContent":["import { nanoid } from 'nanoid';\nimport Cookies from 'js-cookie';\n\nObject.assign(window, { Cookies });\n\njQuery(function($) {\n\n    // random id\n    function rand_element_init(el) {\n        const $el = $(el);\n        const _rand = nanoid(9);\n        $el.addClass(_rand);\n        let _id = $el.attr('id');\n        if (!_id) {\n            _id = _rand;\n            $el.attr('id', _id);\n        }\n\n        return _id;\n    }\n\n    // codemirror\n    if (typeof codemirror_settings !== 'undefined') {\n        const codemirror_css = [ ...document.querySelectorAll('.codemirror_css') ];\n        const codemirror_html = [ ...document.querySelectorAll('.codemirror_html') ];\n\n        function initializeCodeMirror(elements, settings, type) {\n            elements.forEach(function(el) {\n                if (!el.CodeMirror) {\n                    console.log(`Initializing CodeMirror for ${type} on element:`, el);\n                    rand_element_init(el);\n                    let editorSettings = settings ? { ...settings } : {};\n                    editorSettings.codemirror = {\n                        ...editorSettings.codemirror,\n                        indentUnit: 3,\n                        tabSize: 3,\n                        autoRefresh: true,\n                    };\n                    el.CodeMirror = wp.codeEditor.initialize(el, editorSettings);\n                } else {\n                    console.log(`CodeMirror already initialized for ${type} on element:`, el);\n                }\n            });\n        }\n\n        initializeCodeMirror(codemirror_css, codemirror_settings.codemirror_css, 'CSS');\n        initializeCodeMirror(codemirror_html, codemirror_settings.codemirror_html, 'HTML');\n    }\n\n    $.fn.fadeOutAndRemove = function(speed) {\n        return this.fadeOut(speed, function() {\n            $(this).remove();\n        });\n    };\n\n    $.fn.serializeObject = function() {\n        let obj = {};\n        let array = this.serializeArray();\n        $.each(array, function() {\n            let name = this.name;\n            let value = this.value || '';\n            if (name.indexOf('[]') > -1) {\n                name = name.replace('[]', '');\n                if (!obj[name]) {\n                    obj[name] = [];\n                }\n                obj[name].push(value);\n            } else {\n                if (obj[name] !== undefined) {\n                    if (!Array.isArray(obj[name])) {\n                        obj[name] = [ obj[name] ];\n                    }\n                    obj[name].push(value);\n                } else {\n                    obj[name] = value;\n                }\n            }\n        });\n\n        return obj;\n    };\n\n    // hide notice\n    $(document).on('click', '.notice-dismiss', function(e) {\n        $(this).closest('.notice.is-dismissible')?.fadeOutAndRemove(500);\n    });\n\n    // ajax submit settings\n    $(document).on('submit', '#_settings_form', function(e) {\n        e.preventDefault();\n        let $this = $(this);\n        let $data = $this.serializeObject();\n\n        let btn_submit = $this.find('button[name=\"_submit_settings\"]');\n        let button_text = btn_submit.html();\n        let button_text_loading = '<span class=\"ajax-loader\">&nbsp;</span>';\n\n        btn_submit.prop('disabled', true).html(button_text_loading);\n        $.ajax({\n            type: 'POST',\n            url: ajaxurl,\n            data: {\n                action: 'submit_settings',\n                _data: $data,\n                _ajax_nonce: $this.find('input[name=\"_wpnonce\"]').val(),\n                _wp_http_referer: $this.find('input[name=\"_wp_http_referer\"]').val(),\n            },\n        })\n        .done(function(data) {\n            btn_submit.prop('disabled', false).html(button_text);\n            $this.find('#_content').prepend(data);\n\n            // auto reload tab `global_setting`\n            if (window.location.hash === '#global_setting_settings') {\n                window.location.reload();\n            }\n\n            // dismissible auto hide\n            setTimeout(() => {\n                $this.find('#_content')?.find('.dismissible-auto')?.fadeOutAndRemove(400);\n            }, 4000);\n        })\n        .fail(function(jqXHR, textStatus, errorThrown) {\n            btn_submit.prop('disabled', false).html(button_text);\n            console.log(errorThrown);\n        });\n    });\n\n    // filter tabs\n    const $filterTabs = $('.filter-tabs');\n    $filterTabs.each(function() {\n        const $el = $(this),\n            $nav = $el.find('.tabs-nav'),\n            $content = $el.find('.tabs-content'),\n            $tabs = $nav.find('a'),\n            initialHash = window.location.hash;\n\n        const activateTab = (hash) => {\n            const $tab = $nav.find(`a[href=\"${hash}\"]`);\n            $nav.find('a').removeClass('current');\n            $content.find('.tabs-panel').hide();\n\n            if ($tab.length) {\n                $tab.addClass('current');\n                $(hash).show();\n            } else {\n                $tabs.first().addClass('current');\n                $content.find('.tabs-panel').first().show();\n                window.history.replaceState(null, null, window.location.pathname + window.location.search);\n            }\n        };\n\n        activateTab(initialHash || $tabs.first().attr('href'));\n\n        $nav.on('click', 'a', function(e) {\n            e.preventDefault();\n            const hash = $(this).attr('href');\n            window.location.hash = hash;\n            activateTab(hash);\n            $('html, body').animate({ scrollTop: $el.offset().top - $('header').outerHeight() }, 300);\n        });\n\n        $(window).on('hashchange', function() {\n            activateTab(window.location.hash || $tabs.first().attr('href'));\n        });\n    });\n\n    // select2 multiple\n    const select2_multiple = $('.select2-multiple');\n    $.each(select2_multiple, function(i, el) {\n        $(el).select2({\n            multiple: true,\n            allowClear: true,\n            width: 'resolve',\n            dropdownAutoWidth: true,\n            placeholder: $(el).attr('placeholder'),\n        });\n    });\n\n    // select2 tags\n    const select2_tags = $('.select2-tags');\n    $.each(select2_tags, function(i, el) {\n        $(el).select2({\n            multiple: true,\n            tags: true,\n            allowClear: true,\n            width: 'resolve',\n            dropdownAutoWidth: true,\n            placeholder: $(el).attr('placeholder'),\n        });\n    });\n\n    // select2 IPs\n    const select2_ips = $('.select2-ips');\n    $.each(select2_ips, function(i, el) {\n        $(el).select2({\n            multiple: true,\n            tags: true,\n            allowClear: true,\n            width: 'resolve',\n            dropdownAutoWidth: true,\n            placeholder: $(el).attr('placeholder'),\n            createTag: function(params) {\n                let term = $.trim(params.term);\n\n                // Validate the term as an IP address or range\n                if (isValidIPRange(term)) {\n                    return {\n                        id: term, text: term,\n                    };\n                } else {\n                    return null;\n                }\n            },\n        });\n    });\n});\n\n/**\n * validate IP range (IPv4)\n *\n * @param range\n * @returns {boolean}\n */\nfunction isValidIPRange(range) {\n    const ipPattern = /^(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})\\.(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})\\.(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})\\.(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})$/;\n    const rangePattern = /^(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})\\.(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})\\.(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})\\.(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})-(\\d|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])$/;\n    const cidrPattern = /^(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})\\.(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})\\.(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})\\.(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})\\/(\\d|[1-2]\\d|3[0-2])$/;\n\n    if (ipPattern.test(range)) {\n        return true;\n    }\n\n    if (rangePattern.test(range)) {\n        const [ startIP, endRange ] = range.split('-');\n        const endIP = startIP.split('.').slice(0, 3).join('.') + '.' + endRange;\n        return compareIPs(startIP, endIP) < 0;\n    }\n\n    return cidrPattern.test(range);\n}\n\n/**\n * compare two IP addresses\n *\n * @param ip1\n * @param ip2\n * @returns {number}\n */\nfunction compareIPs(ip1, ip2) {\n    const ip1Parts = ip1.split('.').map(Number);\n    const ip2Parts = ip2.split('.').map(Number);\n\n    for (let i = 0; i < 4; i++) {\n        if (ip1Parts[i] < ip2Parts[i]) return -1;\n        if (ip1Parts[i] > ip2Parts[i]) return 1;\n    }\n    return 0;\n}\n"],"names":["Cookies"],"mappings":"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"}